dist: trusty
sudo: false
language: ruby
rvm:
  - 2.3.7
addons:
  apt:
    packages:
    - libcurl4-openssl-dev
cache: bundler
env:
  - TERRAFORM_VERSION=0.12.3 NOKOGIRI_USE_SYSTEM_LIBRARIES=true

# Fetch terraform
before_install:
  - curl -sLo terraform.zip https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip
  - unzip terraform.zip
  - mkdir -p ~/bin
  - mv terraform ~/bin
  - export PATH="~/bin:$PATH"

script:
  - cd infrastructure
  - terraform fmt -check
  - terraform init
  - terraform apply -auto-approve
  - cd .. && cd src
  - gem install jekyll html-proofer
  - jekyll build
  - htmlproofer ./_site

branches:
  only:
    - master